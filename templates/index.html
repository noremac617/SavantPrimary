<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Savant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #000;
      color: #e0e0e0;
      font-family: 'Inter', sans-serif;
    }

    .card {
      background-color: #0f0f0f;
      border: 1px solid #2c2c2c;
      border-radius: 0.75rem;
      box-shadow: 0 0 15px rgba(0, 184, 255, 0.2);
    }

    .card.tab-card {
      background-color: #0f0f0f;
      border: 1px solid #2c2c2c;
      border-top: none;
      border-radius: 0 0.75rem 0.75rem 0.75rem; /* TL, TR, BR, BL */
      box-shadow: 0 4px 15px rgba(0, 184, 255, 0.2);
    }

    .card-header {
      background-color: #2a2a2a;
      border-radius: 0.75rem 0.75rem 0 0;
      font-weight: 600;
      color: #00b8ff;
    }

    .nav-tabs {
      background-color: transparent;
      border: none;
      padding-left: 0;
    }

    .nav-tabs .nav-link {
      color: #ccc;
      background-color: #2c2c2c;
      border: none;
      border-radius: 0.5rem 0.5rem 0 0;
      margin-right: 5px;
      box-shadow: 0 0 10px rgba(0, 184, 255, 0.2);
    }

    .nav-tabs .nav-link.active {
      background-color: #00b8ff;
      color: #000;
      font-weight: bold;
      box-shadow: 0 0 12px rgba(0, 184, 255, 0.3);
    }

    .btn-outline-primary,
    .btn-outline-primary:focus,
    .btn-outline-primary:active,
    .btn-outline-primary:visited {
      border-color: #00b8ff;
      color: #00b8ff;
      box-shadow: none !important;
    }

    .btn-outline-primary:hover {
      background-color: #00b8ff;
      color: #000;
    }

    .table th,
    .table td {
      color: #f0f0f0;
    }

    .table-dark {
      background-color: #121212;
    }

    .form-select,
    input[type="range"],
    input[type="text"],
    input[type="number"] {
      background-color: #2c2c2c;
      color: #f0f0f0;
      border: 1px solid #555;
    }

    input[type="range"]::-webkit-slider-thumb {
      background-color: #00b8ff;
    }

    .form-label,
    .card-body label,
    .card-body strong,
    .card-body {
      color: #f8f8f8;
    }

    .btn {
      font-weight: 600;
    }

    #recent-logs-box {
      background-color: #0f0f0f;
      font-family: monospace;
      font-size: 0.85rem;
      line-height: 1.4;
      padding: 0.75rem 1rem;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #2c2c2c;
      border-top: none;
      border-radius: 0 0 0.75rem 0.75rem;
    }

    #recent-logs-box div {
      margin-bottom: 2px;
      white-space: pre-wrap;
    }

    .navbar {
      background-color: #000;
    }

    .navbar-brand img.logo-img {
      height: 40px;
      filter: drop-shadow(0 0 6px #00b8ff);
      vertical-align: middle;
    }

    .navbar .d-flex.text-end > div {
      line-height: 1.1;
      margin-bottom: 1px;
    }

    .navbar .d-flex.text-end {
      justify-content: center;
    }

    #marketStatus span {
      font-weight: 600;
    }

    #recent-logs-box::-webkit-scrollbar {
      width: 10px;
    }

    #recent-logs-box::-webkit-scrollbar-track {
      background: #222;
    }

    #recent-logs-box::-webkit-scrollbar-thumb {
      background-color: #555;
      border-radius: 5px;
    }

    #recent-logs-box::-webkit-scrollbar-thumb:hover {
      background-color: #777;
    }

    /* Add consistent padding to data collection and optimizer tabs */
    #data.tab-pane,
    #optimizer.tab-pane {
      padding: 1rem !important;
    }
    
    /* Ensure all tab panes start at the same position */
    .tab-content .tab-pane {
      position: relative !important;
      top: 0 !important;
      margin-top: 0 !important;
      padding-top: 0 !important;
    }

    /* Force the tab content container to reset positioning */
    .tab-content {
      position: relative !important;
      overflow: hidden !important;
    }

    /* Specifically fix optimizer tab positioning */
    #optimizer.tab-pane {
      position: relative !important;
      top: 0 !important;
      left: 0 !important;
      margin: 0 !important;
      padding-top: 0 !important;
    }

    /* Ensure Bootstrap's tab switching works correctly */
    .tab-pane:not(.active) {
      display: none !important;
    }

    .tab-pane.active {
      display: block !important;
      position: relative !important;
      top: 0 !important;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-black py-1">
    <div class="mx-auto w-100 px-0" style="max-width: 1200px;">
      <div class="d-flex justify-content-between align-items-center">
        <a class="navbar-brand m-0" href="#">
          <img src="/static/images/logo.png" alt="Savant" class="logo-img">
        </a>
        <div class="d-flex flex-column text-end text-white">
          <div><i class="fa fa-clock me-1"></i><span id="localTime"></span></div>
          <div id="marketStatus" class="small text-muted"></div>
          <div class="small text-light">Opening: {{ open_time }} | Closing: {{ close_time }}</div>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid mt-3 px-2">
    <div class="mx-auto" style="max-width: 1200px;">
      <ul class="nav nav-tabs mt-3" id="mainTabs">
        <li class="nav-item">
          <a class="nav-link {% if show_tab == 'dashboard' %}active{% endif %}" href="#dashboard" data-bs-toggle="tab">
            <i class="fas fa-chart-line me-1"></i> Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if show_tab == 'logs' %}active{% endif %}" href="#logs" data-bs-toggle="tab">
            <i class="fas fa-file-alt me-1"></i> Trade Logs
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if show_tab == 'data' %}active{% endif %}" href="#data" data-bs-toggle="tab">
            <i class="fas fa-database me-1"></i> Data Collection
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if show_tab == 'optimizer' %}active{% endif %}" href="#optimizer" data-bs-toggle="tab">
            <i class="fas fa-cogs me-1"></i> Optimizer
          </a>
        </li>
      </ul>

      <div class="card tab-card mt-0">
        <div class="tab-content p-3">
          <div class="tab-pane fade {% if show_tab == 'dashboard' %}show active{% endif %}" id="dashboard">
            {% include 'dashboard_tab.html' %}
          </div>
          <div class="tab-pane fade {% if show_tab == 'logs' %}show active{% endif %}" id="logs">
            {% include 'logs_tab.html' %}
          </div>
          <div class="tab-pane fade {% if show_tab == 'data' %}show active{% endif %}" id="data">
            {% include 'data_collection_tab.html' %}
          </div>
          <div class="tab-pane fade {% if show_tab == 'optimizer' %}show active{% endif %}" id="optimizer">
            {% include 'optimizer_tab.html' %}
          </div>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Clock + Market Status
    function updateTime() {
      const now = new Date();
      const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: 'America/New_York' };
      const localTime = document.getElementById('localTime');
      if (localTime) localTime.innerText = now.toLocaleTimeString('en-US', options);

      const nyTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
      const day = nyTime.getDay();
      const hours = nyTime.getHours();
      const minutes = nyTime.getMinutes();
      const isWeekday = day >= 1 && day <= 5;
      const afterOpen = (hours > 9) || (hours === 9 && minutes >= 30);
      const beforeClose = (hours < 16);
      const marketOpen = isWeekday && afterOpen && beforeClose;

      const statusEl = document.getElementById('marketStatus');
      if (statusEl) {
        statusEl.innerHTML = marketOpen
          ? '<span class="text-success"><i class="fa fa-circle me-1"></i>Market Open</span>'
          : '<span class="text-danger"><i class="fa fa-circle me-1"></i>Market Closed</span>';
      }
    }

    setInterval(updateTime, 1000);
    updateTime();

    // ðŸ§  Handle tab clicks and persist tab selection
    document.querySelectorAll('a[data-bs-toggle="tab"]').forEach(tab => {
      tab.addEventListener("shown.bs.tab", function (e) {
        const targetTab = new URL(e.target.href).hash.replace("#", "");
        const url = new URL(window.location);
        url.searchParams.set("show_tab", targetTab);
        window.history.replaceState({}, "", url); // Change the URL without reloading
      });
    });

    // ðŸ“Œ On load, activate the correct tab
    const urlParams = new URLSearchParams(window.location.search);
    const tabName = urlParams.get("show_tab") || "dashboard";
    const triggerEl = document.querySelector(`a[href="#${tabName}"]`);
    if (triggerEl) new bootstrap.Tab(triggerEl).show();
  });
</script>
</body>
</html>
